# 开发日志（Append-only）

> 可以记录进展、问题、结论；但“决策”仍以 `决策日志.md` 为准。

## 记录格式（建议）
### YYYY-MM-DD
- 今日目标：
- 实际完成：
- 遇到的问题：
- ✅定稿结论（可写入决策日志/任务单）：
- 明日计划：

---

### 2026-02-09
- 今日目标：建立文档与日志体系，让后续讨论可转 Codex 工单。
- 实际完成：确定最小文档集合与 Append-only 记录规则。
- ✅定稿结论：采用“✅定稿才入决策/任务单”的机制。
- 明日计划：输出第一批 Codex 工单：工程骨架 + RBAC + 基础库表。

### 2026-02-10 14:14:05
- 目标：初始化根目录 Git 仓库并准备 GitHub 首版上传。
- 执行：创建根目录 .gitignore（忽略 .idea、target、开题报告 docx）；开始执行 git 初始化与首提交流程。
- 结果：已完成忽略规则落地，进入 git init/add/commit 阶段。
- 下一步：初始化 main 分支并完成首提交；拿到远端 URL 后推送并回写结果。

### 2026-02-10 14:14:54
- 目标：完成首提交并准备推送 GitHub。
- 执行：git init -b main、git add .、忽略规则核验、尝试 git commit。
- 结果：commit 被阻塞（未配置 user.name / user.email）；其余步骤已完成。
- 下一步：设置本仓库提交身份后重试 commit，并绑定 origin 推送 main。

### 2026-02-10 14:24:10
- 目标：完成 GitHub 首版上传并验证验收项。
- 执行：设置仓库提交身份；完成首提交（b921f2f）；绑定 origin=https://github.com/BCHIIEONG/jnu.git；推送 main；执行状态/忽略/远端分支检查。
- 结果：首版上传成功，origin/main 已创建并跟踪；开题报告 docx 命中忽略规则且未纳入版本库。
- 下一步：按任务单进入 BOOT-001 开发；后续每次操作继续仅追加写入本日志。

### 2026-02-10 14:42:55
- 目标：清理 GitHub 中仅供 Codex 使用的说明文件。
- 执行：删除 4 个 Codex 专用文件；更新 .gitignore 增加 Codex 文件忽略规则。
- 结果：仓库已完成清理，待提交并推送到 origin/main。
- 下一步：完成 commit/push，并给出明日向老师汇报的进展与下一步开发节奏。

### 2026-02-10 14:52:56
- 目标：纠正“仅远端删除 Codex 文件”的执行偏差，并保留本地可回退备份。
- 执行：从历史提交恢复 4 个 Codex 文件到本地工作区；在 备份/2026-02-10_codex_local_only 下生成同内容副本；更新 .gitignore 忽略 备份/。
- 结果：GitHub 仍不包含 Codex 文件；本地与备份均可回退使用；后续备份目录不会再被上传。
- 下一步：进入 BOOT-001 开发，并持续按“开发日志追加”记录。

### 2026-02-10 14:57:42
- 目标：把用户新确认的长期约束固化到执行说明，防止后续遗忘。
- 执行：更新 docs/CODEX_执行说明.md，新增“用户长期约束（2026-02-10）”；同步修正定稿记录路径为 log记录/定稿记录.txt。
- 结果：本地执行说明已固化规则；后续将按“新增规则即追加写入本文件”执行。
- 下一步：继续按 BOOT-001 开发节奏推进，并保持开发日志追加记录。

### 2026-02-10 15:06:04
- 目标：完成 BOOT-001 工程底座并形成可汇报成果。
- 执行：实现统一返回/全局异常/traceId 过滤器/参数校验统一返回；新增 /api/ping 与 /api/ping/echo；配置 Swagger 与 Actuator health；补充集成测试与文档状态更新。
- 结果：执行 lab-flow-report-system\\.\\mvnw.cmd -U clean test 通过（BUILD SUCCESS，5 tests）。
- 下一步：进入 DB-001（Flyway + RBAC 最小表结构）与 AUTH-001（JWT/RBAC 骨架）。

### 2026-02-10 16:29:15
- 目标：按 M2 追赶计划完成 DB-001、AUTH-001 与报告主链后端闭环。
- 执行：新增 Flyway 迁移脚本（V1~V3）、MyBatis-Plus 持久层、JWT 鉴权与 RBAC、安全统一 401/403 返回；实现任务/提交/批阅/反馈/导出接口；补充 H2 测试配置与端到端集成测试。
- 结果：lab-flow-report-system\\.\\mvnw.cmd -U clean test 通过（Tests run: 8, Failures: 0, Errors: 0）；主链接口可联调演示。
- 下一步：如需前端演示，进入 Vue 最小页面联调；如继续后端，进入签到链与设备链。

### 2026-02-10 19:26:38
- 目标：修复 XAMPP MariaDB(MySQL 5.5) 下 Flyway V2 迁移失败导致后端无法启动的问题。
- 执行：将 V2__task_report_core.sql 中的 CLOB 字段类型改为 LONGTEXT（兼容 MariaDB/MySQL）；回归执行 mvn test。
- 结果：lab-flow-report-system\\.\\mvnw.cmd -U clean test 通过（BUILD SUCCESS）。
- 下一步：删除并重建本机库 lab_flow_report（清理失败迁移记录），再启动后端验证 Swagger 可访问。

### 2026-02-15 16:21:48
- 目标：建立“进度报告”材料归档目录，后续所有图/Word/PPT 统一存放，便于向老师汇报。
- 执行：在 C:\\Users\\benso\\Downloads\\进度报告 下创建 01_证据截图/02_用例图/03_数据库设计/04_PPT/05_演示脚本；新增 00_说明_命名与归档规则.txt 记录命名规范。
- 结果：归档目录结构已固定，可直接开始把截图、用例图、数据库说明、PPT、演示脚本按规则落盘。
- 下一步：按“CSV 中文乱码修复 -> 用例图与表说明产出”的顺序补齐汇报材料，并持续追加写入本日志。

### 2026-02-15 16:25:42
- 目标：让“进度报告”目录不只是空文件夹，提供可直接使用的模板与证据文件。
- 执行：在各子目录新增 README_*.txt 说明“放什么/怎么命名”；生成 03_数据库设计\\2026-02-15_db_tables.txt（SHOW TABLES 输出）；新增 05_演示脚本\\演示_主链路_保存CSV.ps1（跑通主链并把 CSV 保存到 01_证据截图）。
- 结果：进度报告目录已包含可用模板与数据库表清单，后续只需要补截图与用例图即可形成汇报材料包。
- 下一步：运行演示脚本生成一份“comment 中文不为 ????”的 CSV；再做 Excel 兼容（BOM）以彻底解决中文乱码。

### 2026-02-15 16:35:45
- 目标：生成可直接用于向老师汇报的“用例图 PNG + 数据库设计 Word（含表格字段解释）”材料。
- 执行：在 Downloads\\进度报告\\02_用例图 生成 5 张用例图 PNG（登录鉴权/教师发布任务/学生提交报告/教师批阅评分/导出成绩CSV）；在 Downloads\\进度报告\\03_数据库设计 生成 ER 图 PNG 与《数据库设计说明_v1.docx》（按每张表生成字段解释表格、外键与索引说明）。
- 结果：材料已落盘，可直接打开查看并用于汇报。
- 下一步：补齐 01_证据截图（health、swagger、链路调用、CSV 文件），以及针对 CSV 中文乱码做“数据源修复 + Excel(BOM)兼容”。

### 2026-02-15 16:58:11
- 目标：对当前项目状态进行总结，并输出一份“从项目到细功能+权限边界+里程碑”的完整规划报告供审查。
- 执行：根据 log记录/定稿记录.txt（范围与周计划）、PLANS.md（当前状态）、docs/（接口/部署/测试等）生成 Word 报告《项目完整规划报告_v1.docx》，输出到 Downloads\\进度报告 根目录。
- 结果：C:\\Users\\benso\\Downloads\\进度报告\\2026-02-15_项目完整规划报告_v1.docx 已生成，可直接用于老师审查与后续对照执行。
- 下一步：按报告中“模块分解与时间计划”补齐未实现模块（签到/设备/进度/查重/管理端）并同步证据截图到 01_证据截图。

### 2026-02-15 17:08:06
- 目标：解决 CSV 导出在 Excel 下常见的 UTF-8 识别问题，并提升 Swagger 联调体验（可直接输入 JWT）。
- 执行：导出接口改为返回 UTF-8 字节并在开头追加 BOM（EF BB BF）；OpenAPI 增加 Bearer JWT 安全方案以显示 Swagger 的 Authorize；更新集成测试覆盖 BOM。
- 结果：`lab-flow-report-system\\.\\mvnw.cmd -U clean test` 通过（BUILD SUCCESS，8 tests）。
- 下一步：用教师 token 实测导出 CSV 在 Excel 双击打开是否中文正常；若仍有“评语变 ????”，优先修复评语写入端（PowerShell/客户端编码）再验证导出。

### 2026-02-15 17:13:17
- 目标：提供“最终验收”逐步测试脚本，并先由 Codex 本机执行一遍验证无问题。
- 执行：新增进度报告脚本 `C:\\Users\\benso\\Downloads\\进度报告\\05_演示脚本\\测试_全套检查_逐步执行.ps1`（可选先跑 mvn test，再跑 E2E 主链路并保存 CSV，校验 UTF-8 BOM）；修正脚本对 Windows PowerShell 5.1 的 UTF-8 JSON 解码兼容（按字节流 UTF-8 解码后 ConvertFrom-Json）。
- 结果：本机执行 `测试_全套检查_逐步执行.ps1 -SkipMvn` 通过；已生成证据文件 `C:\\Users\\benso\\Downloads\\进度报告\\01_证据截图\\2026-02-15_csv_task-3.csv`，其中中文评语正常且 CSV 含 BOM。
- 下一步：你在最终验收时执行同一脚本（建议不加 -SkipMvn），并补齐 health/swagger/PowerShell 截图到 01_证据截图。

### 2026-02-23 20:56:29
- 目标：补齐“已汇报的登录+页面”真实实现，落地 FE-001 三端最小可演示前端，并完成 CORS-001 以支持浏览器联调与下载。
- 执行：
  - 后端：新增 `CorsConfig` 允许 `http://localhost:5173` 跨域访问，暴露 `X-Trace-Id`、`Content-Disposition`；保持 Security `.cors()` 生效。
  - 前端：新增 `frontend/`（Vite + Vue3 + TS + ElementPlus + Pinia + Router），实现登录页与学生/教师/管理员 3 个最小页面，并提供管理员 RBAC 自检面板；教师端支持导出成绩 CSV 下载。
  - 配置：根目录 `.gitignore` 忽略 `frontend/node_modules/`、`frontend/dist/`、`frontend/.env*`。
- 结果：
  - 后端：`lab-flow-report-system\\.\\mvnw.cmd -U clean test` 通过（BUILD SUCCESS，8 tests）。
  - 前端：`frontend\\npm.cmd run build` 通过（可启动 dev server 于 5173）。
- 下一步：更新 `docs/部署说明.md` 增加前端启动步骤；用浏览器实际验证 RBAC 页面跳转与 CSV 下载；随后进入 ATT-001 二维码签到 v1。

### 2026-02-24 03:23:18
- 目标：落地 ADMIN-001 管理员端完整功能（数据库/后端/前端/测试/证据链），满足“用户/院系班级/实验室/设备/学期/日志/导出”可演示。
- 执行：
  - 数据库：新增 Flyway `V5__admin_seed_data.sql`（院系/班级/实验室/设备/学期最小种子数据），确保 H2 与 MySQL 都可迁移至 v5。
  - 后端：新增 `/api/admin/**` 管理员接口（用户管理、角色只读、院系班级、实验室、设备、学期、审计日志、CSV 导出），并对所有写操作写入 `audit_log`；所有 CSV 导出统一加 UTF-8 BOM + `Content-Disposition`。
  - 前端：扩展 `frontend/` 的 `/admin` 为完整管理后台（Tabs：用户/院系/班级/实验室/设备/学期/操作日志/备份说明/RBAC 自检），实现导入/导出与 CRUD 操作。
  - 测试：新增 `AdminIntegrationTests` 覆盖管理员 CRUD + 越权 403 + 导出 BOM + 审计记录存在；回归 `mvn test` 全通过。
- 结果：
  - 后端：`lab-flow-report-system\\.\\mvnw.cmd -U clean test` 通过（包含新 AdminIntegrationTests）。
  - 前端：`frontend\\npm.cmd run build` 通过。
  - 文档：`docs/接口与数据库.md` 已补齐管理员端表与接口清单；`docs/CODEX_执行说明.md` 追加管理员端审计与 CSV 规则。
- 下一步：更新“进度报告”脚本与材料生成脚本（用例图/数据库说明）以覆盖管理员端，并在 `01_证据截图` 生成管理员导出 CSV 证据（Excel 打开中文不乱码）。

### 2026-02-24 03:33:27
- 目标：修复“新增班级后，编辑用户的班级下拉框不实时更新，必须刷新网页”的体验问题。
- 执行：在管理员端 `用户管理` 面板中，打开“新建用户/编辑用户”弹窗前自动重新拉取最新的角色/院系/班级列表；同时在下拉框显示加载状态，避免旧缓存导致异常。
- 结果：新增班级后无需刷新网页，回到用户管理点击编辑即可看到新班级选项；前端构建通过（`npm run build`）。
- 下一步：若还出现“内部错误”，提供后端控制台报错日志（含 traceId），我会按 traceId 定位具体接口与参数并修复。

### 2026-02-24 03:40:20
- 目标：把本轮实现同步到 GitHub，满足“继续下一任务前先推送”的规则。
- 执行：`git add -A`、提交并推送到 `origin/main`。
- 结果：已推送提交 `ea19baf98feb1c0ff137bd004c8410b9248a213d`（ADMIN-001 + 前端实时刷新修复一起入库）。
- 下一步：后续每次你说“继续下一任务/开始下一步”且未说明崩溃，我会先 push 再进入下一任务。

### 2026-02-24 13:47:36
- 目标：修复“老师端看不到学生提交文字”的问题，并补齐“学生上传附件、老师下载/预览附件、下载报告文本”的能力。
- 执行：
  - 后端：新增附件存储配置 `app.storage.dir`（默认 `uploads`，测试用 `target/test-uploads`）；新增附件接口：
    - `POST /api/submissions/{submissionId}/attachments`（学生上传）
    - `GET /api/submissions/{submissionId}/attachments`（授权后查看列表）
    - `GET /api/attachments/{attachmentId}/download`（授权后下载附件）
    - `GET /api/submissions/{submissionId}/content/download`（下载 Markdown 文本，UTF-8 BOM）
  - 前端：教师端新增“查看报告”弹窗展示 `contentMd`，支持下载文本、查看/下载/预览（图片）附件；学生端新增“附件管理”弹窗支持上传/查看/下载/预览（图片）附件。
  - 测试：扩展 `AuthAndWorkflowIntegrationTests` 覆盖附件上传/权限访问/下载与文本下载 BOM；本机 `mvn test`、前端 `npm run build` 通过。
- 结果：老师端可直接看到报告文字并可下载；学生可上传附件，老师与学生均可下载附件，图片可在线预览。
- 下一步：若需要“老师端下载整份报告包（文字+附件打包）”，再追加 ZIP 导出接口与一键下载按钮。
